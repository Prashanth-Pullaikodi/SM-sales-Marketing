<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sandal Mist SHRMS</title>
<?!= include('CSS'); ?>
</head>
<body>

<div id="app-container">

  <!-- TOP NAVBAR -->
  <header class="top-navbar" id="topNavbar">
    <div class="navbar-left">
      <button class="hamburger" id="sidebarToggle" title="Toggle Menu" onclick="toggleSidebar()">
        <span></span><span></span><span></span>
      </button>
      <div class="brand">
        <span class="brand-icon">ğŸ¨</span>
        <span class="brand-name">Sandal Mist</span>
        <span class="brand-badge">SHRMS</span>
      </div>
    </div>

    <div class="navbar-center">
      <div class="search-bar">
        <span class="search-icon">ğŸ”</span>
        <input type="text" id="globalSearch" placeholder="Search reports, leads, bookings..." autocomplete="off" onkeydown="if(event.key==='Enter')showToast('Search coming soon','info')">
      </div>
    </div>

    <div class="navbar-right">
      <button class="nav-btn" id="themeToggle" title="Toggle Dark Mode" onclick="toggleTheme()">ğŸŒ™</button>
      <div class="notification-bell">
        <button class="nav-btn" id="notifBtn" onclick="showNotifications()">ğŸ””</button>
        <span class="notif-badge" id="notifBadge" style="display:none">0</span>
      </div>
      <div class="user-menu" id="userMenuTrigger" onclick="toggleUserMenu()">
        <div class="avatar" id="userAvatar">?</div>
        <div class="user-info">
          <span class="user-name" id="navUserName">Loading...</span>
          <span class="user-role" id="navUserRole">-</span>
        </div>
        <span class="dropdown-arrow">â–¾</span>
      </div>
    </div>
  </header>

  <!-- USER DROPDOWN -->
  <div class="user-dropdown" id="userDropdown">
    <div class="dropdown-header">
      <div class="dropdown-avatar" id="ddAvatar">?</div>
      <div>
        <div class="dropdown-name" id="ddName">-</div>
        <div class="dropdown-email" id="ddEmail">-</div>
        <span class="dropdown-role" id="ddRole">-</span>
      </div>
    </div>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" onclick="closeUserMenu();showPage('profile')">ğŸ‘¤ My Profile</a>
    <a class="dropdown-item" id="ddAdminLink" style="display:none" onclick="closeUserMenu();showPage('admin')">âš™ï¸ Admin Panel</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="https://mail.google.com" target="_blank">ğŸ“§ Open Gmail</a>
    <a class="dropdown-item" onclick="closeUserMenu();showHelp()">â“ Help & Guide</a>
  </div>

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <nav class="sidebar-nav">
      <div class="nav-section-label">MAIN</div>
      <a class="nav-item" data-page="dashboard" onclick="showPage('dashboard')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Dashboard</span>
      </a>

      <div class="nav-section-label">SALES</div>
      <a class="nav-item" data-page="dsr" onclick="showPage('dsr')">
        <span class="nav-icon">ğŸ“</span>
        <span class="nav-label">Daily Reports</span>
      </a>
      <a class="nav-item" data-page="travel" onclick="showPage('travel')">
        <span class="nav-icon">âœˆï¸</span>
        <span class="nav-label">Travel Plans</span>
        <span class="nav-count" id="travelCount" style="display:none"></span>
      </a>
      <a class="nav-item" data-page="leads" onclick="showPage('leads')">
        <span class="nav-icon">ğŸ¯</span>
        <span class="nav-label">Leads</span>
      </a>
      <a class="nav-item" data-page="bookings" onclick="showPage('bookings')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-label">Bookings</span>
      </a>

      <div class="nav-section-label">ANALYTICS</div>
      <a class="nav-item" data-page="reports" onclick="showPage('reports')">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-label">Reports</span>
      </a>
      <a class="nav-item" data-page="incentives" onclick="showPage('incentives')">
        <span class="nav-icon">ğŸ’°</span>
        <span class="nav-label">Incentives</span>
      </a>

      <div class="nav-section-label" id="mgmtLabel" style="display:none">MANAGEMENT</div>
      <a class="nav-item" data-page="admin" id="adminNavItem" style="display:none" onclick="showPage('admin')">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-label">Admin Panel</span>
      </a>

      <div class="nav-section-label">ACCOUNT</div>
      <a class="nav-item" data-page="profile" onclick="showPage('profile')">
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-label">My Profile</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <div class="app-version">v1.0.0</div>
      <div class="sidebar-user" id="sidebarUser">-</div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content" id="mainContent">
    <div class="toast-container" id="toastContainer"></div>
    <div id="page-dashboard" class="page"></div>
    <div id="page-dsr"       class="page"></div>
    <div id="page-travel"    class="page"></div>
    <div id="page-leads"     class="page"></div>
    <div id="page-bookings"  class="page"></div>
    <div id="page-reports"   class="page"></div>
    <div id="page-incentives"class="page"></div>
    <div id="page-admin"     class="page"></div>
    <div id="page-profile"   class="page"></div>
  </main>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
<div class="modal" id="mainModal">
  <div class="modal-header">
    <h3 id="modalTitle">-</h3>
    <button class="modal-close" onclick="closeModal()">âœ•</button>
  </div>
  <div class="modal-body" id="modalBody"></div>
  <div class="modal-footer" id="modalFooter"></div>
</div>

<!-- PASS SERVER DATA TO CLIENT SAFELY -->
<script>
// These variables are set by the GAS template engine server-side
var CURRENT_USER = {
  name:  "<?= userName ?>",
  email: "<?= userEmail ?>",
  role:  "<?= userRole ?>"
};
</script>

<?!= include('TableEnhancer'); ?>
<?!= include('JS'); ?>

</body>
</html>

